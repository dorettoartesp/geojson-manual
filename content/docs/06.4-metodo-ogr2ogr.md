---
title: "6.4. Op√ß√£o 4: ogr2ogr (CLI)"
weight: 64
bookToc: true
---

## **6.4.4 OP√á√ÉO 4: ogr2ogr (Convers√£o Direta CSV ‚Üí GeoJSON)** ‚ö†Ô∏è M√©todo Avan√ßado

**‚ö†Ô∏è ATEN√á√ÉO:** Este m√©todo requer conhecimento de linha de comando e instala√ß√£o do GDAL. Se voc√™ √© iniciante, recomendamos usar a [**Op√ß√£o 1**]({{< relref "06.1-metodo-excel" >}}) ou [**Op√ß√£o 2**]({{< relref "06.2-metodo-wkt" >}}).

Use esta op√ß√£o se voc√™ prefere usar linha de comando e j√° tem as geometrias no CSV (como WKT ou lat/lon).

**O que √© ogr2ogr:**
`ogr2ogr` √© uma ferramenta de linha de comando do GDAL que converte entre diversos formatos geoespaciais, incluindo CSV para GeoJSON.

---

## **A. Instala√ß√£o:**

**Linux**:
```bash
sudo apt install gdal-bin  # Debian/Ubuntu
sudo pacman -S gdal        # Arch Linux
```

**Mac**:
```bash
brew install gdal
```

**Windows**:
- Baixe OSGeo4W: [https://trac.osgeo.org/osgeo4w/](https://trac.osgeo.org/osgeo4w/)
- Ou instale via conda: `conda install -c conda-forge gdal`

---

## **B. Preparar CSV com Geometria WKT:**

Certifique-se de que seu CSV tem uma coluna `wkt` com as geometrias:

```csv
id,wkt,lote,rodovia,item,detalhamento_servico,unidade,quantidade,km_inicial,km_final,local,data_inicial,data_final,observacoes_gerais
conserva-001,"LINESTRING(-46.633308 -23.550520, -46.634567 -23.551234)",L13,SP0000280,a.1.1,Recupera√ß√£o funcional do pavimento,km,5.25,22.500,27.750,PISTA_NORTE;PISTA_SUL,2026-03-15,2026-07-20,Per√≠odo noturno
conserva-002,"POINT(-46.635000 -23.552000)",L13,SP0000330,c.2.4,Sinaliza√ß√£o vertical,un,15,132.100,138.500,PISTA_NORTE,2026-02-01,2026-02-15,
```

---

## **C. Converter usando ogr2ogr:**

### **Op√ß√£o C.1: CSV com coluna WKT**

```bash
ogr2ogr -f GeoJSON \
  -s_srs EPSG:4674 \
  -t_srs EPSG:4674 \
  -oo GEOM_POSSIBLE_NAMES=wkt \
  -oo KEEP_GEOM_COLUMNS=NO \
  L13_conservacao_2026_R0.geojson \
  dados_com_wkt.csv
```

### **Op√ß√£o C.2: CSV com colunas lat/lon**

```bash
ogr2ogr -f GeoJSON \
  -s_srs EPSG:4674 \
  -t_srs EPSG:4674 \
  -oo X_POSSIBLE_NAMES=lon \
  -oo Y_POSSIBLE_NAMES=lat \
  -oo KEEP_GEOM_COLUMNS=NO \
  L13_conservacao_2026_R0.geojson \
  dados_com_latlon.csv
```

**Explica√ß√£o dos par√¢metros:**
- `-f GeoJSON`: Formato de sa√≠da
- `-s_srs EPSG:4674`: Sistema de refer√™ncia de origem (SIRGAS 2000)
- `-t_srs EPSG:4674`: Sistema de refer√™ncia de destino (SIRGAS 2000)
- `-oo GEOM_POSSIBLE_NAMES=wkt`: Nome da coluna com geometria WKT
- `-oo X_POSSIBLE_NAMES=lon`: Nome da coluna com longitude
- `-oo Y_POSSIBLE_NAMES=lat`: Nome da coluna com latitude
- `-oo KEEP_GEOM_COLUMNS=NO`: N√£o manter colunas wkt/lat/lon no GeoJSON final

---

## **D. Resultado Esperado:**

O GeoJSON gerado ter√° esta estrutura:

```json
{
  "type": "FeatureCollection",
  "name": "dados_com_wkt",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "id": "conserva-001",
        "lote": "L13",
        "rodovia": "SP0000280",
        "item": "a.1.1",
        "local": "PISTA_NORTE;PISTA_SUL",
        ...
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [[-46.633308, -23.55052], [-46.634567, -23.551234]]
      }
    }
  ]
}
```

---

## **E. ‚ö†Ô∏è IMPORTANTE - Ajustes Necess√°rios:**

O arquivo gerado pelo `ogr2ogr` **N√ÉO estar√° 100% conforme o schema R0**. Voc√™ ainda precisar√°:

1. ‚ùå **Remover campo `name`** (se existir):
   - Deletar a linha `"name": "dados_com_wkt",`

2. ‚ùå **Adicionar campo `crs` correto**:
   - O ogr2ogr pode omitir o CRS ou usar formato RFC7946
   - Voc√™ precisa adicionar manualmente:
   ```json
   "crs": {
     "type": "name",
     "properties": {
       "name": "urn:ogc:def:crs:EPSG::4674"
     }
   },
   ```

3. ‚ùå **Adicionar campo `metadata`**:
   ```json
   "metadata": {
     "schema_version": "R0",
     "data_geracao": "2025-11-08T10:30:00-03:00"
   },
   ```

4. ‚ùå **Converter campo `local` de string para array**:
   - De: `"local": "PISTA_NORTE;PISTA_SUL"`
   - Para: `"local": ["PISTA_NORTE", "PISTA_SUL"]`
   - Use uma das op√ß√µes descritas em [Adicionar Metadados e Ajustar Formato]({{< relref "06.5-exportar-validar#661-converter-campo-local-de-string-para-array-obrigat√≥rio" >}}) (manual, regex, script Python, ou jq)

---

## **Vantagens e Desvantagens**

**Vantagens:**
- ‚úÖ Geometria j√° vem pronta no GeoJSON
- ‚úÖ N√£o precisa usar interface gr√°fica do QGIS
- ‚úÖ R√°pido para grandes volumes de dados
- ‚úÖ Pode ser automatizado em scripts

**Desvantagens:**
- ‚ùå Requer instala√ß√£o do GDAL/ogr2ogr
- ‚ùå Ainda precisa de ajustes manuais no JSON (CRS, metadata, campo `local`)
- ‚ùå Requer conhecimento de linha de comando

---

## **F. Prosseguir para o Passo 5**

Continue para [Adicionar Metadados e Ajustar Formato]({{< relref "06.5-exportar-validar" >}}).

---

**üìå Pr√≥ximo passo:**

‚û°Ô∏è [Adicionar Metadados e Validar]({{< relref "06.5-exportar-validar" >}})
