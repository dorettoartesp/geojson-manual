---
title: "6.1. Op√ß√£o 1: F√≥rmula Excel/Calc"
weight: 61
bookToc: true
---

## **6.1 OP√á√ÉO 1: F√≥rmula Excel/Calc para POINT/MULTIPOINT (Autom√°tica)** üåü

Use esta op√ß√£o quando voc√™ tem coordenadas de `km_inicial` e `km_final` e deseja gerar automaticamente geometrias POINT ou MULTIPOINT.

**Quando usar:**
- ‚úÖ Voc√™ tem coordenadas dos pontos inicial e final de cada servi√ßo
- ‚úÖ Deseja processo r√°pido e autom√°tico
- ‚úÖ Servi√ßos pontuais ou com dois pontos de refer√™ncia

**O que a f√≥rmula faz:**
- Se `km_inicial = km_final` (coordenadas iguais) ‚Üí Gera **POINT** (servi√ßo pontual)
- Se `km_inicial ‚â† km_final` (coordenadas diferentes) ‚Üí Gera **MULTIPOINT** (dois pontos de refer√™ncia)

---

### **Passo A: Adicionar Coluna WKT com F√≥rmula**

1. **Certifique-se** de que voc√™ j√° preencheu as 4 colunas de coordenadas (conforme [Se√ß√£o 6.3.D]({{< relref "06-preparacao-dados#d-adicionar-colunas-de-coordenadas" >}})):
   - `lon_inicio`, `lat_inicio`, `lon_fim`, `lat_fim`

2. **Crie uma nova coluna** chamada `wkt` (ap√≥s as colunas de coordenadas)

3. **Escolha e copie a f√≥rmula adequada** para seu software:

---

### **üìä F√≥rmulas por Software**

**MICROSOFT EXCEL (Portugu√™s):**

```excel
=SE(E(lon_inicio=lon_fim;lat_inicio=lat_fim);"POINT("&lon_inicio&" "&lat_inicio&")";"MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

**MICROSOFT EXCEL (English):**

```excel
=IF(AND(lon_inicio=lon_fim,lat_inicio=lat_fim),"POINT("&lon_inicio&" "&lat_inicio&")","MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

---

**LIBREOFFICE CALC (Portugu√™s):**

```calc
=SE(E(lon_inicio=lon_fim;lat_inicio=lat_fim);"POINT("&lon_inicio&" "&lat_inicio&")";"MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

**LIBREOFFICE CALC (English):**

```calc
=IF(AND(lon_inicio=lon_fim,lat_inicio=lat_fim),"POINT("&lon_inicio&" "&lat_inicio&")","MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

---

**ONLYOFFICE SPREADSHEET (Portugu√™s):**

```excel
=SE(E(lon_inicio=lon_fim;lat_inicio=lat_fim);"POINT("&lon_inicio&" "&lat_inicio&")";"MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

**ONLYOFFICE SPREADSHEET (English):**

```excel
=IF(AND(lon_inicio=lon_fim,lat_inicio=lat_fim),"POINT("&lon_inicio&" "&lat_inicio&")","MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

---

4. **Cole a f√≥rmula** na primeira c√©lula da coluna `wkt` (linha 2, se linha 1 √© cabe√ßalho)

5. **Copie a f√≥rmula** para todas as linhas de dados:
   - Selecione a c√©lula com a f√≥rmula
   - Copie (Ctrl+C)
   - Selecione todas as c√©lulas abaixo (at√© a √∫ltima linha de dados)
   - Cole (Ctrl+V)

---

### **Passo B: Verificar Resultado**

**Exemplo de sa√≠da:**

| id           | lon_inicio | lat_inicio | lon_fim  | lat_fim  | wkt | Tipo Gerado |
|:-------------|:-----------|:-----------|:---------|:---------|:----|:------------|
| conserva-001 | -46.6333   | -23.5505   | -46.6333 | -23.5505 | `POINT(-46.6333 -23.5505)` | Pontual (in√≠cio = fim) |
| conserva-002 | -46.6333   | -23.5505   | -46.6345 | -23.5515 | `MULTIPOINT(-46.6333 -23.5505, -46.6345 -23.5515)` | Dois pontos de refer√™ncia |

**Verifique:**
- ‚úÖ WKT est√° no formato correto (sem v√≠rgulas como separador decimal)
- ‚úÖ POINT tem apenas 1 coordenada
- ‚úÖ MULTIPOINT tem 2 coordenadas separadas por v√≠rgula

---

### **Passo C: Exportar para CSV**

1. **Salve a planilha como CSV:**
   - Menu: **Arquivo ‚Üí Salvar Como**
   - Formato: **CSV (delimitado por v√≠rgulas) (.csv)**
   - Codifica√ß√£o: **UTF-8**
   - Nome: `dados_com_wkt.csv`

2. **IMPORTANTE:** Verifique que o separador decimal no CSV √© **ponto (.)**

---

### **Passo D: Importar no QGIS**

1. **Abra o QGIS** (baixe em [https://qgis.org/download/](https://qgis.org/download/) se necess√°rio)

2. **Menu:** Camada ‚Üí Adicionar Camada ‚Üí **Adicionar Camada de Texto Delimitado**

3. **Configura√ß√£o:**
   - **Nome da camada:** `conservacao_2026` (ou nome apropriado)
   - **Nome do arquivo:** Selecione seu `dados_com_wkt.csv`
   - **Formato de arquivo:** CSV (v√≠rgulas)
   - **Codifica√ß√£o:** UTF-8
   - **Defini√ß√£o de geometria:** **Defini√ß√£o de geometria WKT**
   - **Campo de geometria:** `wkt`
   - **CRS da geometria:** **EPSG:4674 - SIRGAS 2000**

4. **Clique em "Adicionar"**

5. **Verifique:** As geometrias devem aparecer no mapa

---

### **Passo E: Prosseguir para Exporta√ß√£o**

Continue para [Exportar para GeoJSON]({{< relref "06.5-exportar-validar" >}}).

---

## **‚ö†Ô∏è Notas Importantes**

**1. POINT vs MULTIPOINT:**
- **POINT:** Servi√ßo em um √∫nico local (ex: instala√ß√£o de equipamento no km 25.3)
- **MULTIPOINT:** Representa dois pontos de refer√™ncia (in√≠cio e fim do trecho)
- **MULTIPOINT N√ÉO √© a geometria completa da rodovia** - s√£o apenas pontos de refer√™ncia

**2. Quando MULTIPOINT √© apropriado:**
- ‚úÖ Para visualiza√ß√£o dos pontos de in√≠cio e fim do servi√ßo
- ‚úÖ Quando precis√£o da geometria intermedi√°ria n√£o √© cr√≠tica
- ‚úÖ Como solu√ß√£o r√°pida e autom√°tica

**3. Quando MULTIPOINT N√ÉO √© apropriado:**
- ‚ùå Se voc√™ precisa de LineString que segue o tra√ßado da rodovia
- ‚ùå Se voc√™ precisa de Polygon representando √°rea precisa
- ‚ùå Se requisitos exigem geometria detalhada

**Para geometrias precisas (LineString/Polygon seguindo tra√ßado), use [Op√ß√£o 3 (QGIS Desenho Manual)]({{< relref "06.3-metodo-qgis" >}}).**

**4. Separador Decimal:**
- A f√≥rmula gera WKT com ponto (.) como separador
- Se voc√™ v√™ v√≠rgulas no WKT, revise a [Se√ß√£o 6.3.D]({{< relref "06-preparacao-dados#d-adicionar-colunas-de-coordenadas" >}}) sobre formata√ß√£o de coordenadas

---

## **üìã F√≥rmula com Valida√ß√£o Autom√°tica (Avan√ßado)**

Se voc√™ quer que a f√≥rmula converta automaticamente v√≠rgulas para pontos no WKT, use esta vers√£o:

**Excel/OnlyOffice (Portugu√™s) - COM VALIDA√á√ÉO:**

```excel
=SE(SOMA(√âN√öM(lon_inicio);√âN√öM(lat_inicio);√âN√öM(lon_fim);√âN√öM(lat_fim))<4;"‚ùå ERRO: Coordenadas inv√°lidas";SE(E(lon_inicio=lon_fim;lat_inicio=lat_fim);"POINT("&SUBSTITUIR(TEXTO(lon_inicio;"0.000000");",";".")&" "&SUBSTITUIR(TEXTO(lat_inicio;"0.000000");",";".")&")";"MULTIPOINT("&SUBSTITUIR(TEXTO(lon_inicio;"0.000000");",";".")&" "&SUBSTITUIR(TEXTO(lat_inicio;"0.000000");",";".")&", "&SUBSTITUIR(TEXTO(lon_fim;"0.000000");",";".")&" "&SUBSTITUIR(TEXTO(lat_fim;"0.000000");",";".")&")"))
```

**Excel/OnlyOffice (English) - WITH VALIDATION:**

```excel
=IF(SUM(ISNUMBER(lon_inicio),ISNUMBER(lat_inicio),ISNUMBER(lon_fim),ISNUMBER(lat_fim))<4,"‚ùå ERROR: Invalid coordinates",IF(AND(lon_inicio=lon_fim,lat_inicio=lat_fim),"POINT("&SUBSTITUTE(TEXT(lon_inicio,"0.000000"),",",".")&" "&SUBSTITUTE(TEXT(lat_inicio,"0.000000"),",",".")&")","MULTIPOINT("&SUBSTITUTE(TEXT(lon_inicio,"0.000000"),",",".")&" "&SUBSTITUTE(TEXT(lat_inicio,"0.000000"),",",".")&", "&SUBSTITUTE(TEXT(lon_fim,"0.000000"),",",".")&" "&SUBSTITUTE(TEXT(lat_fim,"0.000000"),",",".")&")"))
```

**LibreOffice Calc (Portugu√™s) - COM VALIDA√á√ÉO:**

```calc
=SE(SOMA(√âN√öMERO(lon_inicio);√âN√öMERO(lat_inicio);√âN√öMERO(lon_fim);√âN√öMERO(lat_fim))<4;"‚ùå ERRO: Coordenadas inv√°lidas";SE(E(lon_inicio=lon_fim;lat_inicio=lat_fim);"POINT("&SUBSTITUIR(TEXTO(lon_inicio;"0,000000");",";".")&" "&SUBSTITUIR(TEXTO(lat_inicio;"0,000000");",";".")&")";"MULTIPOINT("&SUBSTITUIR(TEXTO(lon_inicio;"0,000000");",";".")&" "&SUBSTITUIR(TEXTO(lat_inicio;"0,000000");",";".")&", "&SUBSTITUIR(TEXTO(lon_fim;"0,000000");",";".")&" "&SUBSTITUIR(TEXTO(lat_fim;"0,000000");",";".")&")"))
```

**LibreOffice Calc (English) - WITH VALIDATION:**

```calc
=IF(SUM(ISNUMBER(lon_inicio),ISNUMBER(lat_inicio),ISNUMBER(lon_fim),ISNUMBER(lat_fim))<4,"‚ùå ERROR: Invalid coordinates",IF(AND(lon_inicio=lon_fim,lat_inicio=lat_fim),"POINT("&SUBSTITUTE(TEXT(lon_inicio,"0.000000"),",",".")&" "&SUBSTITUTE(TEXT(lat_inicio,"0.000000"),",",".")&")","MULTIPOINT("&SUBSTITUTE(TEXT(lon_inicio,"0.000000"),",",".")&" "&SUBSTITUTE(TEXT(lat_inicio,"0.000000"),",",".")&", "&SUBSTITUTE(TEXT(lon_fim,"0.000000"),",",".")&" "&SUBSTITUTE(TEXT(lat_fim,"0.000000"),",",".")&")"))
```

**Essa f√≥rmula:**
- ‚úÖ Valida se as coordenadas s√£o n√∫meros v√°lidos
- ‚úÖ Converte automaticamente v√≠rgulas para pontos
- ‚úÖ Mant√©m 6 casas decimais
- ‚ùå Mostra erro se dados estiverem incorretos

**Use a vers√£o simples se suas coordenadas j√° est√£o formatadas corretamente com ponto decimal.**

---

## **üîß Solu√ß√£o de Problemas Comuns**

### **Problema 1: WKT gerado com v√≠rgulas no lugar de pontos**

**Sintoma:**
```
MULTIPOINT(-46,6333 -23,5505, -46,6345 -23,5515)  ‚ùå INV√ÅLIDO
```

**Solu√ß√µes:**

**Op√ß√£o A:** Use a f√≥rmula com valida√ß√£o (se√ß√£o acima) que converte automaticamente

**Op√ß√£o B:** Formate as c√©lulas de coordenadas como N√∫mero:
1. Selecione colunas lon_inicio, lat_inicio, lon_fim, lat_fim
2. Clique direito ‚Üí Formatar C√©lulas ‚Üí N√∫mero
3. Casas decimais: 6
4. Refa√ßa a f√≥rmula WKT

**Op√ß√£o C:** Localizar e Substituir no WKT gerado:
1. Selecione a coluna `wkt`
2. Ctrl+H (Localizar e Substituir)
3. Localizar: `,`
4. Substituir: `.`
5. **ATEN√á√ÉO:** Isto substituir√° TODAS as v√≠rgulas, inclusive as que separam coordenadas no MULTIPOINT
6. **Solu√ß√£o:** Substituir primeiro `, ` (v√≠rgula+espa√ßo) por `; ` (ponto-e-v√≠rgula+espa√ßo), depois `,` por `.`, depois `; ` de volta para `, `

**Op√ß√£o D (Mais Segura):** Use substitui√ß√£o com regex no VS Code:
1. Abra o CSV no VS Code
2. Ctrl+H, ative regex (√≠cone `.*`)
3. Localizar: `(-?\d+),(\d+)`
4. Substituir: `$1.$2`
5. Substituir Tudo

---

### **Problema 2: F√≥rmula retorna erro #NOME? ou #VALUE!**

**Causas poss√≠veis:**

1. **Nomes de fun√ß√£o em idioma errado:**
   - Se Excel est√° em portugu√™s, use `SE`, `E`, `CONCATENAR`
   - Se Excel est√° em ingl√™s, use `IF`, `AND`, `CONCATENATE`

2. **Nomes de colunas incorretos:**
   - Verifique se as colunas se chamam exatamente: `lon_inicio`, `lat_inicio`, `lon_fim`, `lat_fim`
   - Sem espa√ßos, sem acentos

3. **C√©lulas vazias:**
   - Certifique-se de que todas as 4 colunas de coordenadas est√£o preenchidas
   - Use a f√≥rmula com valida√ß√£o para detectar c√©lulas vazias

---

### **Problema 3: MULTIPOINT sempre gerado, mesmo quando coordenadas s√£o iguais**

**Causa:** Coordenadas aparentemente iguais t√™m pequenas diferen√ßas nas casas decimais

**Solu√ß√£o:** Arredonde as coordenadas para 6 casas decimais:

```excel
=SE(E(ARRED(lon_inicio;6)=ARRED(lon_fim;6);ARRED(lat_inicio;6)=ARRED(lat_fim;6));"POINT("&lon_inicio&" "&lat_inicio&")";"MULTIPOINT("&lon_inicio&" "&lat_inicio&", "&lon_fim&" "&lat_fim&")")
```

---

### **Problema 4: QGIS n√£o reconhece geometrias ao importar CSV**

**Solu√ß√µes:**

1. **Verifique formato do WKT:**
   - Deve ser exatamente: `POINT(lon lat)` ou `MULTIPOINT(lon1 lat1, lon2 lat2)`
   - Sem aspas extras, sem espa√ßos no in√≠cio/fim

2. **Verifique codifica√ß√£o do CSV:**
   - Deve ser UTF-8
   - Ao salvar, escolha explicitamente "CSV UTF-8"

3. **Configura√ß√£o no QGIS:**
   - "Defini√ß√£o de geometria": selecione "Defini√ß√£o de geometria WKT"
   - "Campo de geometria": selecione a coluna `wkt`
   - "CRS da geometria": EPSG:4674

4. **Separador de CSV:**
   - Se o CSV usa ponto-e-v√≠rgula (`;`) como delimitador, altere nas configura√ß√µes do QGIS
   - Ou salve novamente o Excel como "CSV (delimitado por v√≠rgulas)"

---

**üìå Pr√≥ximo passo:**

‚û°Ô∏è [Exportar para GeoJSON e Validar]({{< relref "06.5-exportar-validar" >}})
